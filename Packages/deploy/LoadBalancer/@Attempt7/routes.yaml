---
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: HTTPRoute
metadata:
  name: route-web-server
  namespace: default
spec:
  parentRefs:
    - name: gateway-http
    - name: gateway-https # temp-disabled (traefik issue 9158)
  hostnames:
  - "9m2x1z.nodes.c1.or1.k8s.ovh.us"
  - "debating.app"
  - "debatemap.app"
  - "debates.app"
  rules:
    - backendRefs:
        - name: dm-web-server
          port: 5100
      matches:
        #- {path: {type: "Exact", value: "/test1"}}

        # Match all paths, except for those starting with "/.well-known". (since that signifies an ACME certificate-challenge solver request)
        # Note that this exclusion is not really necessary (the solver routes override this generic one anyway), but this makes cert-manager error-messages less confusing.
        #- {path: {type: "RegularExpression", value: "^(?!/.well-known)"}} # basically, match everything except a path that starts with "/." (see above)
        #- {path: {type: "RegularExpression", value: "^(?!/\\.well-known)"}} # basically, match everything except a path that starts with "/." (see above)
        - {path: {type: "RegularExpression", value: "/[a-zA-Z0-9_-]"}} # basically, match everything except a path that starts with "/." (see above)
      # matches:
      #   -
      #     type: Exact
      #     value: "/test1"
---
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: HTTPRoute
metadata:
  name: route-app-server
  namespace: default
spec:
  parentRefs:
    - name: gateway-http
    - name: gateway-https # temp-disabled (traefik issue 9158)
  hostnames:
  - "app-server.9m2x1z.nodes.c1.or1.k8s.ovh.us"
  - "app-server.debating.app"
  - "app-server.debatemap.app"
  - "app-server.debates.app"
  rules:
    - backendRefs:
      - name: dm-app-server
        port: 5110
      #matches: [{path: {type: Exact, value: "/test1"}}]
---
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: HTTPRoute
metadata:
  name: route-monitor
  namespace: default
spec:
  parentRefs:
    - name: gateway-http
    - name: gateway-https # temp-disabled (traefik issue 9158)
  hostnames:
  - "monitor.9m2x1z.nodes.c1.or1.k8s.ovh.us"
  - "monitor.debating.app"
  - "monitor.debatemap.app"
  - "monitor.debates.app"
  rules:
    - backendRefs:
      - name: dm-monitor-backend
        port: 5130
      #matches: [{path: {type: Exact, value: "/test1"}}]

# in other namespaces
# ==========

---
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: HTTPRoute
metadata:
  name: route-grafana
  namespace: monitoring
spec:
  parentRefs:
    - name: gateway-http
      namespace: default
    # temp-disabled (traefik issue 9158)
    - name: gateway-https
      namespace: default
  hostnames:
  - "grafana.9m2x1z.nodes.c1.or1.k8s.ovh.us"
  - "grafana.debating.app"
  - "grafana.debatemap.app"
  - "grafana.debates.app"
  rules:
    - backendRefs:
      - name: loki-stack-grafana
        #port: 3000
        port: 80
      #matches: [{path: {type: Exact, value: "/test1"}}]